# Absensi Likes Instagram & Knowledge Base Cicero

Dokumen ini merangkum cara dashboard mengelola absensi likes Instagram serta bagaimana halaman knowledge base mendukung operator di lapangan.

## Alur Pengambilan Data

1. Halaman **Instagram Engagement Insight** menjalankan hook `useInstagramLikesData` untuk mengambil data berdasarkan mode tampilan yang dipilih (today, yesterday, weekly, monthly, custom range). Hook ini memanfaatkan `useAuth` untuk memperoleh token, `client_id`, role, serta nilai override `effectiveRole`/`effectiveClientType` (dengan fallback `localStorage`) sebelum memutuskan cakupan data. Nilai `effectiveClientType` dinormalisasi ke `undefined` saat kosong agar helper direktori menerima tipe yang valid.【F:cicero-dashboard/hooks/useInstagramLikesData.ts†L18-L90】
2. Untuk rentang tanggal, hook memanggil `getPeriodeDateForView` sehingga parameter periode, tanggal tunggal, atau rentang tanggal selalu konsisten dengan format backend.【F:cicero-dashboard/hooks/useInstagramLikesData.ts†L80-L96】
3. Saat role pengguna adalah **Ditbinmas** (atau kombinasi khusus **DITSAMAPTA** + role **BIDHUMAS** yang masih memerlukan jalur ini), hook men-delegasikan proses ke `fetchDitbinmasAbsensiLikes`. Utilitas ini menerima `effectiveClientId` sehingga jalur DITSAMAPTA BIDHUMAS otomatis memuat profil dan rekap via klien BIDHUMAS, sementara akun Ditbinmas lain tetap memakai ID root. Jalur ini **tidak lagi memanggil `/api/dashboard/stats`**; seluruh data posts, ringkasan total, direktori client, dan daftar user diambil dari payload `/api/insta/rekap-likes`. Untuk mendukung hal tersebut, backend diharapkan mengirim metadata direktori pada payload rekap dalam bentuk daftar `clients` (atau `directory`) berisi `client_id`, `client_name`/`nama_client`, dan opsional `role` agar nama kesatuan dapat dipetakan tanpa lookup tambahan. Hasil akhirnya berupa daftar user terpadu, rekap ringkas, daftar posting, dan nama klien agregat hanya dari endpoint rekap tersebut.【F:cicero-dashboard/hooks/useInstagramLikesData.ts†L42-L353】【F:cicero-dashboard/utils/absensiLikes.ts†L1-L215】
4. Untuk role selain Ditbinmas, hook mengambil profil klien guna menentukan apakah akun termasuk direktorat atau ORG. Klien direktorat diberikan dropdown lingkup: ketika `scope: "client"`, rekap lintas satker hasil agregasi dinormalisasi kembali ke `client_id` login, sedangkan `scope: "all"` menampilkan agregat direktorat penuh. Jalur direktorat juga **sepenuhnya bergantung pada `/api/insta/rekap-likes`** untuk direktori user, jumlah post (`summary.totalPosts`), serta ringkasan status like tanpa fallback ke `/api/dashboard/stats`. Klien ORG melewati dropdown ini, selalu memakai scope ORG, dan seluruh permintaan profil tetap berbasis `client_id` login agar data tidak difan-out ke daftar client lain.【F:cicero-dashboard/hooks/useInstagramLikesData.ts†L230-L660】【F:cicero-dashboard/app/likes/instagram/page.jsx†L1-L160】
5. Untuk role **operator**, hook selalu memakai `client_id` login untuk `getClientProfile` dan `getRekapLikesIG`. Parameter `role=operator` dan `scope` hasil normalisasi `effectiveClientType` ikut dikirim agar backend menyeleksi tugas operator pada satker login ketika scope ORG, selaras dengan standar di Cicero_V2. Mode direktorat/ditbinmas dinonaktifkan, sehingga kontrol lingkup tidak muncul dan data sosial media hanya berasal dari satker operator tersebut. Daftar rekap juga difilter agar hanya menampilkan personel ber-role operator pada `client_id` login; jika rekap tidak membawa atribut role, hook melakukan lookup direktori user untuk mencocokkan `user_id`/NRP/NIP operator sebelum merender ringkasan. Seluruh ringkasan UI, termasuk jumlah post, bersumber dari payload `/api/insta/rekap-likes` tanpa ketergantungan pada statistik dashboard.【F:cicero-dashboard/hooks/useInstagramLikesData.ts†L90-L356】
6. Fungsi `getRekapLikesIG` kini menggunakan helper `resolveRoleScopeRegionalOptions` yang menggabungkan `AbortSignal` dan opsi `role`/`scope`/`regional_id` (termasuk bila sinyal disematkan di objek opsi). Dengan begitu setiap pemanggilan `/api/insta/rekap-likes` otomatis menambahkan parameter `scope` dan `regional_id` di query string ketika tersedia, meskipun pemanggil hanya menyuplai `signal` atau opsi terpisah, sehingga mekanisme filter regional tetap konsisten di seluruh jalur hook dan utilitas absensi.【F:cicero-dashboard/utils/api.ts†L1177-L1217】

## Perhitungan Ringkasan Absensi

- Baik pada mode Ditbinmas maupun klien biasa, sistem menghitung ulang jumlah **Sudah Like**, **Kurang Like**, **Belum Like**, serta **Tanpa Username** dengan membandingkan `jumlah_like` terhadap total posting yang dirilis pada hari tersebut. Untuk jalur direktorat/ditbinmas, total posting wajib bersumber dari payload `/api/insta/rekap-likes` (`summary.totalPosts` atau field ekivalen), tanpa fallback ke `/api/dashboard/stats`. Jika belum ada posting, seluruh user dianggap belum melakukan likes agar status tetap mudah dipantau.【F:cicero-dashboard/utils/absensiLikes.ts†L1-L215】【F:cicero-dashboard/hooks/useInstagramLikesData.ts†L356-L694】
- Ringkasan tersebut ditampilkan di komponen `SummaryItem` bersama persentase yang dihitung dari total user valid (total user dikurangi akun tanpa username). Komponen berada di namespace gabungan `components/likes/instagram/Insight` agar berbagi gaya dengan chart utama.【F:cicero-dashboard/app/likes/instagram/page.jsx†L41-L120】【F:cicero-dashboard/components/likes/instagram/Insight/SummaryItem.jsx†L1-L160】
- Kartu ringkasan di halaman Instagram Engagement Insight kini memakai templat standar (label, nilai, warna palet, ikon) yang sama dengan TikTok Engagement Insight: enam metrik tetap (jumlah IG post, total user, sudah/kurang/belum like, dan tanpa username) menggunakan komponen `SummaryItem` bawaan agar operator melihat pola seragam lintas platform.【F:cicero-dashboard/app/likes/instagram/InstagramEngagementInsightView.jsx†L101-L168】【F:cicero-dashboard/app/comments/tiktok/TiktokEngagementInsightView.jsx†L74-L155】

## Standarisasi Rekap Personel

- Segment **Rekap Personel Instagram** menyamakan desain dengan halaman TikTok: status baris memakai `clampEngagementCompleted` agar jumlah like tidak melampaui target posting, pencarian ikut membersihkan label satfung/polsek serta `client_id`, dan tabel zebra menampilkan badge status, detail client + ID, serta footer pagination Prev/Reset/Next yang menyatu dengan tabel seperti standar TikTok Engagement Insight.【F:cicero-dashboard/components/likes/instagram/Rekap/RekapLikesIG.jsx†L1-L360】

## Pengelompokan dan Visualisasi

- Hook mengembalikan flag `isDirectorate`, `isOrgClient`, `isDitbinmasScopedClient`, dan `clientName`. Informasi ini menentukan apakah chart akan digrup berdasarkan divisi, kelompok (menggunakan `groupUsersByKelompok` dari `utils/instagramEngagement.ts`), atau langsung per Polres saat memvisualisasikan data. Pada mode direktorat, pemilihan grouping (client vs divisi), judul, dan orientasi chart mengikuti metadata yang tersedia di payload `/api/insta/rekap-likes` sehingga UI DIREKTORAT sepenuhnya mengandalkan rekap tersebut.【F:cicero-dashboard/app/likes/instagram/InstagramEngagementInsightView.jsx†L89-L223】【F:cicero-dashboard/app/likes/instagram/page.jsx†L21-L160】【F:cicero-dashboard/utils/instagramEngagement.ts†L1-L69】
- Data yang sudah difilter dikirim ke komponen `ChartBox` dan `ChartHorizontal` untuk menampilkan ranking likes dan tabel pendukung, sehingga operator mendapatkan gambaran kinerja secara cepat.【F:cicero-dashboard/app/likes/instagram/page.jsx†L85-L200】

## Rekap Otomatis via WA

- Tombol **Copy Rekap** tersedia di header filter tab insight/rekap dan memanggil utilitas `buildInstagramRekap` pada modul `utils/instagramEngagement.ts`. Fungsi ini membangkitkan pesan sapaan otomatis berisi ringkasan global serta daftar per klien dengan ikon ✅/⚠️/❌/⁉️, menyesuaikan cakupan Ditbinmas (client/all) sebelum menempel ke clipboard untuk WAG.【F:cicero-dashboard/app/likes/instagram/page.jsx†L85-L160】【F:cicero-dashboard/utils/instagramEngagement.ts†L71-L120】

## Knowledge Base Pendukung

- **Mekanisme Sistem Absensi** (`/mekanisme-absensi`) menyediakan blueprint aktor (Ditbinmas, Operator, Personil, Sistem), alur kerja empat langkah, matriks RACI, dan istilah integrasi seperti Re-fetch, Shadowban, Auto Recap, serta Attendance Score. Konten ini membantu pemangku kepentingan memahami konteks di balik angka absensi.【F:cicero-dashboard/app/mekanisme-absensi/page.jsx†L1-L320】
- **Panduan & SOP** (`/panduan-sop`) memuat panduan registrasi dan update data via WA bot, langkah harian operator, FAQ shadowban, SOP likes & komentar, hingga SOP operator Polres. Halaman ini juga mengumumkan nomor WA bot terbaru yang wajib digunakan seluruh anggota.【F:cicero-dashboard/app/panduan-sop/page.jsx†L1-L320】

Gunakan kedua halaman knowledge base sebagai referensi resmi saat melakukan onboarding, audit SOP, atau menjawab pertanyaan lapangan yang berulang.
