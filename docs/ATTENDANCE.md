# Absensi Likes Instagram & Knowledge Base Cicero

Dokumen ini merangkum cara dashboard mengelola absensi likes Instagram serta bagaimana halaman knowledge base mendukung operator di lapangan.

## Alur Pengambilan Data

1. Halaman **Instagram Engagement Insight** menjalankan hook `useInstagramLikesData` untuk mengambil data berdasarkan mode tampilan yang dipilih (today, yesterday, weekly, monthly, custom range). Hook ini memanfaatkan `useAuth` untuk memperoleh token, `client_id`, role, serta nilai override `effectiveRole`/`effectiveClientType` (dengan fallback `localStorage`) sebelum memutuskan cakupan data. Saat profil masih dimuat, hook menunggu hingga scope/regional dari profil tersedia agar pemanggilan `/api/insta/rekap-likes` tidak terjadi tanpa parameter `scope`/`regional_id`. Seluruh data chart, kartu ringkasan, dan tabel rekap sekarang **100% bersumber dari `/api/insta/rekap-likes`** tanpa pemanggilan endpoint lain untuk melengkapi metadata.【F:cicero-dashboard/hooks/useInstagramLikesData.ts†L79-L481】
2. Untuk rentang tanggal, hook memanggil `getPeriodeDateForView` sehingga parameter periode, tanggal tunggal, atau rentang tanggal selalu konsisten dengan format backend.【F:cicero-dashboard/hooks/useInstagramLikesData.ts†L80-L96】
3. Untuk seluruh role termasuk **Ditbinmas** dan kombinasi **DITSAMAPTA** + **BIDHUMAS**, hook hanya memanggil `/api/insta/rekap-likes`. Metadata direktori (daftar `clients`/`directory`), ringkasan total, daftar user, dan daftar posting diambil dari payload rekap yang sama tanpa lookup tambahan, sehingga semua mode (client/all) tetap konsisten di satu sumber data.【F:cicero-dashboard/hooks/useInstagramLikesData.ts†L77-L566】
4. Penentuan layout direktorat dan opsi `scope` (client/all) sekarang hanya berdasarkan `effectiveRole`/`effectiveClientType` serta metadata `scope` yang tersedia di payload rekap. Jika metadata client/divisi tidak tersedia di payload rekap, UI menampilkan label fallback seperti **Unknown Client/Divisi** alih-alih memanggil endpoint tambahan.【F:cicero-dashboard/hooks/useInstagramLikesData.ts†L353-L608】【F:cicero-dashboard/app/likes/instagram/InstagramEngagementInsightView.jsx†L89-L245】
5. Untuk role **operator**, hook tetap menggunakan `client_id` login saat meminta rekap dan hanya melakukan penyaringan role ketika tipe klien efektif bukan **ORG** (mengacu pada `effectiveClientType` yang dinormalisasi). Penyaringan user operator hanya dilakukan ketika payload rekap sudah membawa atribut role; jika tidak tersedia maka seluruh daftar rekap ditampilkan apa adanya demi menjaga sumber data tetap tunggal dari `/api/insta/rekap-likes`.【F:cicero-dashboard/hooks/useInstagramLikesData.ts†L261-L602】
6. Fungsi `getRekapLikesIG` kini menggunakan helper `resolveRoleScopeRegionalOptions` yang menggabungkan `AbortSignal` dan opsi `role`/`scope`/`regional_id` (termasuk bila sinyal disematkan di objek opsi). Dengan begitu setiap pemanggilan `/api/insta/rekap-likes` otomatis menambahkan parameter `scope` dan `regional_id` di query string ketika tersedia, meskipun pemanggil hanya menyuplai `signal` atau opsi terpisah, sehingga mekanisme filter regional tetap konsisten di seluruh jalur hook dan utilitas absensi.【F:cicero-dashboard/utils/api.ts†L1177-L1217】

## Perhitungan Ringkasan Absensi

- Baik pada mode Ditbinmas maupun klien biasa, sistem menghitung ulang jumlah **Sudah Like**, **Kurang Like**, **Belum Like**, serta **Tanpa Username** dengan membandingkan `jumlah_like` terhadap total posting yang dirilis pada hari tersebut. Total posting wajib bersumber dari payload `/api/insta/rekap-likes` (`summary.totalPosts` atau field ekivalen) tanpa fallback ke endpoint lain. Jika belum ada posting, seluruh user dianggap belum melakukan likes agar status tetap mudah dipantau.【F:cicero-dashboard/hooks/useInstagramLikesData.ts†L533-L703】
- Ringkasan tersebut ditampilkan di komponen `SummaryItem` bersama persentase yang dihitung dari total user valid (total user dikurangi akun tanpa username). Komponen berada di namespace gabungan `components/likes/instagram/Insight` agar berbagi gaya dengan chart utama.【F:cicero-dashboard/app/likes/instagram/page.jsx†L41-L120】【F:cicero-dashboard/components/likes/instagram/Insight/SummaryItem.jsx†L1-L160】
- Kartu ringkasan di halaman Instagram Engagement Insight kini memakai templat standar (label, nilai, warna palet, ikon) yang sama dengan TikTok Engagement Insight: enam metrik tetap (jumlah IG post, total user, sudah/kurang/belum like, dan tanpa username) menggunakan komponen `SummaryItem` bawaan agar operator melihat pola seragam lintas platform.【F:cicero-dashboard/app/likes/instagram/InstagramEngagementInsightView.jsx†L101-L168】【F:cicero-dashboard/app/comments/tiktok/TiktokEngagementInsightView.jsx†L74-L155】

## Standarisasi Rekap Personel

- Segment **Rekap Personel Instagram** menyamakan desain dengan halaman TikTok: status baris memakai `clampEngagementCompleted` agar jumlah like tidak melampaui target posting, pencarian ikut membersihkan label satfung/polsek serta `client_id`, dan tabel zebra menampilkan badge status, detail client + ID, serta footer pagination Prev/Reset/Next yang menyatu dengan tabel seperti standar TikTok Engagement Insight.【F:cicero-dashboard/components/likes/instagram/Rekap/RekapLikesIG.jsx†L1-L360】

## Pengelompokan dan Visualisasi

- Hook mengembalikan flag `isDirectorateData`, `isDirectorateLayout`, `isOrgClient`, `isDirectorateScopedClient`, serta `clientName`. Informasi ini menentukan apakah chart akan digrup berdasarkan divisi, kelompok (menggunakan `groupUsersByKelompok` dari `utils/instagramEngagement.ts`), atau langsung per Polres saat memvisualisasikan data. Pada mode direktorat, pemilihan grouping (client vs divisi), judul, dan orientasi chart mengikuti metadata yang tersedia di payload `/api/insta/rekap-likes` sehingga UI DIREKTORAT sepenuhnya mengandalkan rekap tersebut.【F:cicero-dashboard/app/likes/instagram/InstagramEngagementInsightView.jsx†L89-L245】【F:cicero-dashboard/app/likes/instagram/page.jsx†L21-L160】【F:cicero-dashboard/utils/instagramEngagement.ts†L1-L69】
- Data yang sudah difilter dikirim ke komponen `ChartBox` dan `ChartHorizontal` untuk menampilkan ranking likes dan tabel pendukung, sehingga operator mendapatkan gambaran kinerja secara cepat.【F:cicero-dashboard/app/likes/instagram/page.jsx†L85-L200】

## Rekap Otomatis via WA

- Tombol **Copy Rekap** tersedia di header filter tab insight/rekap dan memanggil utilitas `buildInstagramRekap` pada modul `utils/instagramEngagement.ts`. Fungsi ini membangkitkan pesan sapaan otomatis berisi ringkasan global serta daftar per klien dengan ikon ✅/⚠️/❌/⁉️, menyesuaikan cakupan Ditbinmas (client/all) sebelum menempel ke clipboard untuk WAG.【F:cicero-dashboard/app/likes/instagram/page.jsx†L85-L160】【F:cicero-dashboard/utils/instagramEngagement.ts†L71-L120】

## Knowledge Base Pendukung

- **Mekanisme Sistem Absensi** (`/mekanisme-absensi`) menyediakan blueprint aktor (Ditbinmas, Operator, Personil, Sistem), alur kerja empat langkah, matriks RACI, dan istilah integrasi seperti Re-fetch, Shadowban, Auto Recap, serta Attendance Score. Konten ini membantu pemangku kepentingan memahami konteks di balik angka absensi.【F:cicero-dashboard/app/mekanisme-absensi/page.jsx†L1-L320】
- **Panduan & SOP** (`/panduan-sop`) memuat panduan registrasi dan update data via WA bot, langkah harian operator, FAQ shadowban, SOP likes & komentar, hingga SOP operator Polres. Halaman ini juga mengumumkan nomor WA bot terbaru yang wajib digunakan seluruh anggota.【F:cicero-dashboard/app/panduan-sop/page.jsx†L1-L320】

Gunakan kedua halaman knowledge base sebagai referensi resmi saat melakukan onboarding, audit SOP, atau menjawab pertanyaan lapangan yang berulang.
