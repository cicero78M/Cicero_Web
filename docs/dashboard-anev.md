# Dashboard ANEV Polres

Halaman **/anev/polres** menampilkan rekap aktivitas, kepatuhan, serta performa konten lintas platform. Per Juni 2025, normalisasi payload ANEV untuk **TikTok per satfung/divisi** membaca lebih banyak variasi field dan menampilkan metrik tambahan (views, likes, comments, shares, engagement rate) agar operator bisa menilai kualitas interaksi, bukan sekadar volume posting.

## Normalisasi data
- Payload ANEV dapat mengirim data TikTok melalui berbagai jalur: `tiktok.*`, `anev.tiktok*`, ringkasan `tiktok_summary`, maupun variasi map/array di `aggregates.raw` dan `aggregates.totals` (`tiktok_per_satfung`, `tiktok_posts_per_satfung`, `tiktok_engagement_per_satfung`, atau `performance.*`). Fungsi `resolveTiktokPerformanceBySatfung` di `app/anev/polres/page.tsx` menyisir kandidat tersebut dan memetakan ke `TiktokPerformanceRow` berisi `posts`, `engagement`, plus metrik opsional `views/likes/comments/shares`. Engagement memakai bidang `engagement/interaction` bila tersedia; jika tidak, dijumlahkan dari likes+comments+shares. `engagementRate` dibaca dari payload atau dihitung otomatis dari engagement per views bila views tersedia sehingga kartu tetap mengisi ER meski backend hanya mengirim angka dasar.【F:cicero-dashboard/app/anev/polres/page.tsx†L22-L559】
- Normalisasi satfung/divisi lain (posting per platform, user per satfung, likes Instagram per satfung) tetap dipertahankan dan tidak terpengaruh perubahan TikTok.【F:cicero-dashboard/app/anev/polres/page.tsx†L62-L281】
- Type `DashboardAnevAggregates` di `utils/api.ts` kini menyalurkan ulang field breakdown satfung/divisi (`user_per_satfung`, `users_per_satfung`, `satfung_breakdown`, `division_breakdown`, `user_breakdown`, serta `breakdown`/`breakdowns`) dari payload agregat sehingga akses langsung di halaman ANEV tetap terketik tanpa harus bergantung pada `raw`.【F:cicero-dashboard/utils/api.ts†L763-L862】
- Fungsi `getDashboardAnev` menormalkan filter akses (role, scope, regional_id) menjadi uppercase sebelum dikirim ke API sekaligus mempertahankan fallback dari konteks login ketika backend tidak mengembalikan nilai tersebut. Snapshot filter di UI tetap menampilkan nilai yang dikirim ke server agar operator bisa menelusuri kombinasi filter yang aktif.【F:cicero-dashboard/utils/api.ts†L684-L723】【F:cicero-dashboard/utils/api.ts†L1686-L1779】
- Permintaan data di halaman ANEV Polres dideduplikasi berdasar kombinasi filter (time_range, start_date, end_date, role, scope, regional_id, client_id) sehingga fetch tidak dipanggil dua kali untuk filter identik. Klik Apply atau Reset selalu mereset kunci deduplikasi agar pengguna bisa memuat ulang data dengan kombinasi yang sama jika diperlukan.【F:cicero-dashboard/app/anev/polres/page.tsx†L863-L942】
- Preset rentang waktu meliputi `today`, `7d`, `30d`, `90d`, `all`, dan `custom`. Nilai preset dihitung via `derivePresetRange` yang memakai `formatDateInput` untuk menyelaraskan tanggal ke zona waktu backend (menggeser offset lokal sebelum diubah ke string `YYYY-MM-DD`), termasuk preset 90 hari yang mundur 89 hari dari tanggal hari ini. Preset `all` tidak menetapkan tanggal agar backend dapat menafsirkan rentang bebas.【F:cicero-dashboard/app/anev/polres/page.tsx†L26-L120】【F:cicero-dashboard/app/anev/polres/page.tsx†L650-L707】
- Respons API dapat mengirim `permitted_time_ranges`; UI hanya menampilkan preset yang diizinkan dan otomatis memaksa pilihan ke opsi pertama yang diizinkan jika preset sebelumnya dilarang, sehingga permintaan berikutnya selalu memakai kombinasi yang diperbolehkan. Validasi untuk preset `custom` tetap mewajibkan `start_date` dan `end_date` sebelum tombol Apply dapat digunakan.【F:cicero-dashboard/app/anev/polres/page.tsx†L738-L814】【F:cicero-dashboard/app/anev/polres/page.tsx†L1156-L1236】

## UI ringkas
- Seksi **TikTok per Satfung/Divisi** kini menampilkan badge Engagement Rate (ER) ketika tersedia, kartu posting/engagement utama, serta chip kecil untuk views, likes, comments, dan shares jika dikirim backend. Empty state memberi petunjuk field ANEV yang perlu dikirim (`tiktok_per_satfung` atau breakdown serupa) sehingga operator tahu data yang hilang berasal dari payload, bukan bug UI.【F:cicero-dashboard/app/anev/polres/page.tsx†L1006-L1086】
- Seksi ini tetap berada di antara rekap user per satfung/divisi dan likes Instagram per satfung/divisi agar alur membaca tetap platform-first (TikTok → Instagram → kepatuhan). Snapshot filter, kartu metrik utama, dan tabel kepatuhan tidak berubah sehingga pengalaman premium tetap konsisten.【F:cicero-dashboard/app/anev/polres/page.tsx†L926-L1103】
- Status premium memakai loader inline tanpa label agar kartu informasi tetap padat saat verifikasi berlangsung. Komponen `Loader` kini menerima `inline`, `label`, serta `containerClassName` untuk menyesuaikan ukuran spinner di ruang sempit tanpa mengubah fallback loading lain.【F:cicero-dashboard/app/anev/polres/page.tsx†L897-L909】【F:cicero-dashboard/components/Loader.tsx†L1-L37】

Gunakan filter waktu, scope, role, dan regional ID di bagian atas halaman untuk memicu pengambilan ulang data ANEV dengan konteks baru. Empty state akan berguna sebagai indikator ketika backend belum mengembalikan metrik TikTok untuk kombinasi filter tertentu.
Dashboard juga menyisipkan `client_id` dari sesi login ketika memanggil API dan menampilkannya di snapshot filter sehingga operator tahu konteks polres yang sedang aktif.【F:cicero-dashboard/app/anev/polres/page.tsx†L16-L119】【F:cicero-dashboard/app/anev/polres/page.tsx†L854-L918】
